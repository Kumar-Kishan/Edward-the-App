{"version":3,"sources":["webpack:///./src/app/exporter/pdf.js","webpack:///./src/app/exporter/exporter.page.vue?c2cb","webpack:///src/app/exporter/exporter.page.vue","webpack:///./src/app/exporter/exporter.page.vue","webpack:///./src/app/exporter/json.js"],"names":["__webpack_require__","_pdfmake2","default","vfs","_vfs_fonts2","pdfMake","chaptersToPdf","title","chapters","_promise2","resolve","_definition$content","definition","content","text","style","styles","body","fontSize","bold","blockquote","margin","chapterHeading","h1","h2","h3","italic","italics","strike","decoration","underline","splitContent","getNewSegment","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","_getIterator3","next","done","chapter","value","push","pageBreak","currentLine","ops","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_currentLine$style","op","insert","_getStyles","getStyles","attributes","lineStyles","length","apply","_toConsumableArray3","includes","_insert$split","split","_insert$split2","_toArray3","first","lines","slice","segment","ix","err","return","counter","forEach","ul","ol","start","concat","createPdf","getBlob","blob","window","_integration","_pdfSuccess","_fileSaver2","saveAs","listMap","bullet","ordered","attr","d","__webpack_exports__","staticRenderFns","render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_e","loading","directives","name","rawName","expression","attrs","id","type","domProps","checked","Array","isArray","includeArchived","_i","on","change","$event","$$a","$$el","target","$$c","$$i","for","click","exportPdfChapters","exportPdfPlans","exportPdfOutlines","exportPdfWorkshops","exportJsonDocument","accept","setFile","_json","_cache","_pdf","_document","_storageSwitch","PulseLoader","_PulseLoader2","plans","workshops","guid","isPremium","topics","_this","backup","_backup","documentGuid","documentTitle","resetCache","then","dispatch","CHANGE_DOCUMENT","_this2","_this3","archived","_this4","topic","nestedTopics","_this5","plan","section","nestedPlans","_this6","workshop","date","order","toString","workshopName","_this7","willOverwrite","_node_modules_vue_loader_lib_runtime_component_normalizer__WEBPACK_IMPORTED_MODULE_2__","__vue_styles__","context","Component","Object","_babel_loader_node_modules_vue_loader_lib_selector_type_script_index_0_exporter_page_vue__WEBPACK_IMPORTED_MODULE_0___default","a","_node_modules_vue_loader_lib_template_compiler_index_id_data_v_4d0eb590_hasScoped_true_optionsId_0_buble_transforms_node_modules_vue_loader_lib_selector_type_template_index_0_exporter_page_vue__WEBPACK_IMPORTED_MODULE_1__","backupToJsonFile","json","_stringify2","Blob","today","Date","getDate","getMonth","getFullYear","jsonFileToBackup","file","reject","reader","FileReader","onload","result","JSON","parse","e","readAsText"],"mappings":"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","file":"static/js/4.a1e8c0160d1c63340535.js","sourcesContent":["import pdfMake from 'pdfmake/build/pdfmake'\r\nimport pdfFonts from 'pdfmake/build/vfs_fonts.js'\r\nimport FileSaver from 'file-saver'\r\n\r\npdfMake.vfs = pdfFonts.pdfMake.vfs\r\n\r\nexport const chaptersToPdf = (title, chapters) => {\r\n  return new Promise((resolve) => {\r\n    const definition = {\r\n      content: [{\r\n        text: title,\r\n        style: 'title'\r\n      }],\r\n      styles: {\r\n        body: {\r\n          fontSize: 12\r\n        },\r\n        bold: {\r\n          bold: true\r\n        },\r\n        blockquote: {\r\n          margin: [10, 10, 0, 10]\r\n        },\r\n        chapterHeading: {\r\n          fontSize: 20,\r\n          margin: [5, 10]\r\n        },\r\n        h1: {\r\n          fontSize: 18\r\n        },\r\n        h2: {\r\n          fontSize: 16\r\n        },\r\n        h3: {\r\n          fontSize: 14\r\n        },\r\n        italic: {\r\n          italics: true\r\n        },\r\n        strike: {\r\n          decoration: 'lineThrough'\r\n        },\r\n        title: {\r\n          fontSize: 40\r\n        },\r\n        underline: {\r\n          decoration: 'underline'\r\n        }\r\n      }\r\n    }\r\n\r\n    const splitContent = []\r\n\r\n    function getNewLine () {\r\n      return {\r\n        text: [],\r\n        style: []\r\n      }\r\n    }\r\n\r\n    function getNewSegment (text, style) {\r\n      return {\r\n        text: text || '',\r\n        style: style || []\r\n      }\r\n    }\r\n\r\n    for (const chapter of chapters) {\r\n      splitContent.push({\r\n        text: chapter.title,\r\n        style: 'chapterHeading',\r\n        pageBreak: 'before'\r\n      })\r\n\r\n      let currentLine = getNewLine()\r\n      const ops = (chapter.content && chapter.content.ops) || []\r\n      for (const op of ops) {\r\n        const insert = op.insert\r\n        const { styles, lineStyles } = getStyles(op.attributes)\r\n\r\n        if (lineStyles.length) {\r\n          currentLine.style.push(...lineStyles)\r\n        }\r\n\r\n        if (insert === '\\n') {\r\n          splitContent.push(currentLine)\r\n          currentLine = getNewLine()\r\n          continue\r\n        }\r\n\r\n        if (insert.includes('\\n')) {\r\n          const [first, ...lines] = insert.split('\\n')\r\n          if (first) {\r\n            const segment = getNewSegment(first, styles)\r\n            currentLine.text.push(segment)\r\n          }\r\n\r\n          splitContent.push(currentLine)\r\n          currentLine = getNewLine()\r\n\r\n          for (let ix = 0; ix < lines.length - 1; ix++) {\r\n            const line = lines[ix]\r\n            const segment = getNewSegment(line, styles)\r\n            currentLine.text.push(segment)\r\n\r\n            splitContent.push(currentLine)\r\n            currentLine = getNewLine()\r\n          }\r\n\r\n          const last = lines[lines.length - 1]\r\n          const segment = getNewSegment(last, styles)\r\n          currentLine.text.push(segment)\r\n\r\n          continue\r\n        }\r\n\r\n        const segment = getNewSegment(insert, styles)\r\n        currentLine.text.push(segment)\r\n      }\r\n    }\r\n\r\n    let counter = 1\r\n    splitContent.forEach(content => {\r\n      if (content.style.includes('ul')) {\r\n        content.ul = [{ text: content.text }]\r\n        counter = 1\r\n        content.text = null\r\n      } else if (content.style.includes('ol')) {\r\n        content.ol = [{ text: content.text }]\r\n        content.start = counter++\r\n        content.text = null\r\n      } else {\r\n        counter = 1\r\n      }\r\n      return content\r\n    })\r\n\r\n    definition.content = definition.content.concat(...splitContent)\r\n\r\n    pdfMake.createPdf(definition).getBlob(blob => {\r\n      if (window && window._integration) {\r\n        window._pdfSuccess = true\r\n        return resolve()\r\n      }\r\n      FileSaver.saveAs(blob, `${title}.pdf`)\r\n      resolve()\r\n    })\r\n  })\r\n}\r\n\r\nconst listMap = {\r\n  'bullet': 'ul',\r\n  'ordered': 'ol'\r\n}\r\nfunction getStyles (attributes) {\r\n  const styles = []\r\n  const lineStyles = []\r\n\r\n  if (!attributes) {\r\n    return { styles, lineStyles }\r\n  }\r\n\r\n  for (const attr in attributes) {\r\n    if (['bold', 'italic', 'underline', 'strike'].includes(attr)) {\r\n      styles.push(attr)\r\n      continue\r\n    }\r\n\r\n    if (attr === 'header') {\r\n      lineStyles.push(`h${attributes[attr]}`)\r\n      continue\r\n    }\r\n\r\n    if (attr === 'blockquote') {\r\n      lineStyles.push('blockquote')\r\n      continue\r\n    }\r\n\r\n    if (attr === 'list') {\r\n      lineStyles.push(listMap[attributes[attr]])\r\n      continue\r\n    }\r\n  }\r\n\r\n  return { styles, lineStyles }\r\n}\r\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"wrap\"},[_c('div',{staticClass:\"exporter\"},[_c('div',{staticClass:\"export-option\"},[_c('h3',[_vm._v(\"Export to PDF\")]),_vm._v(\" \"),_c('div',[_vm._v(\"(You can open PDFs in Microsoft Word.)\")]),_vm._v(\" \"),(_vm.loading)?_c('pulse-loader'):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"export-checkbox\"},[(!_vm.loading)?_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.includeArchived),expression:\"includeArchived\"}],attrs:{\"id\":\"includeArchived\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.includeArchived)?_vm._i(_vm.includeArchived,null)>-1:(_vm.includeArchived)},on:{\"change\":function($event){var $$a=_vm.includeArchived,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.includeArchived=$$a.concat([$$v]))}else{$$i>-1&&(_vm.includeArchived=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.includeArchived=$$c}}}}):_vm._e(),_vm._v(\" \"),(!_vm.loading)?_c('label',{attrs:{\"for\":\"includeArchived\"}},[_vm._v(\"Include Archived\")]):_vm._e()]),_vm._v(\" \"),(!_vm.loading)?[_c('button',{staticClass:\"button-green export-button\",on:{\"click\":function($event){_vm.exportPdfChapters()}}},[_vm._v(\"\\n          Export all chapters\\n        \")]),_vm._v(\" \"),_c('button',{staticClass:\"button-green export-button\",on:{\"click\":function($event){_vm.exportPdfPlans()}}},[_vm._v(\"\\n          Export all plans\\n        \")]),_vm._v(\" \"),_c('button',{staticClass:\"button-green export-button\",on:{\"click\":function($event){_vm.exportPdfOutlines()}}},[_vm._v(\"\\n          Export all outlines\\n        \")]),_vm._v(\" \"),(_vm.isPremium)?_c('button',{staticClass:\"button-green export-button\",on:{\"click\":function($event){_vm.exportPdfWorkshops()}}},[_vm._v(\"\\n          Export all workshops\\n        \")]):_vm._e()]:_vm._e()],2),_vm._v(\" \"),_c('div',{staticClass:\"export-option\"},[_c('h3',[_vm._v(\"Create a backup\")]),_vm._v(\" \"),_c('div',[_vm._v(\"(You can recover your document from this file later.)\")]),_vm._v(\" \"),(_vm.loading)?_c('pulse-loader'):_vm._e(),_vm._v(\" \"),(!_vm.loading)?_c('button',{staticClass:\"button-green export-button\",on:{\"click\":function($event){_vm.exportJsonDocument()}}},[_vm._v(\"\\n        Export entire document\\n      \")]):_vm._e()],1),_vm._v(\" \"),_c('div',{staticClass:\"export-option\"},[_c('h3',[_vm._v(\"Import a backup\")]),_vm._v(\" \"),_c('div',[_vm._v(\"\\n        (Warning: This will overwrite the current document completely, including all chapters, plans and outlines.)\\n      \")]),_vm._v(\" \"),_c('div',{staticClass:\"file-input-container\"},[(_vm.loading)?_c('pulse-loader'):_vm._e(),_vm._v(\" \"),(!_vm.loading)?[_c('label',{staticClass:\"file-input-label\",attrs:{\"for\":\"import-file-picker\"}}),_vm._v(\" \"),_c('input',{staticClass:\"file-input\",attrs:{\"id\":\"import-file-picker\",\"type\":\"file\",\"accept\":\".json\"},on:{\"change\":_vm.setFile}}),_vm._v(\" \"),_c('button',{staticClass:\"button-green export-button file-dummy-button\"},[_vm._v(\"\\n            Import entire document\\n          \")])]:_vm._e()],2)])])])}\nvar staticRenderFns = []\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"wrap\">\r\n    <div class=\"exporter\">\r\n      <div class=\"export-option\">\r\n        <h3>Export to PDF</h3>\r\n        <div>(You can open PDFs in Microsoft Word.)</div>\r\n        <pulse-loader v-if=\"loading\"></pulse-loader>\r\n        <div class=\"export-checkbox\">\r\n          <input id=\"includeArchived\" v-if=\"!loading\" type=\"checkbox\" v-model=\"includeArchived\">\r\n          <label for=\"includeArchived\" v-if=\"!loading\">Include Archived</label>\r\n        </div>\r\n        <template v-if=\"!loading\">\r\n          <button class=\"button-green export-button\" @click=\"exportPdfChapters()\">\r\n            Export all chapters\r\n          </button>\r\n          <button class=\"button-green export-button\" @click=\"exportPdfPlans()\">\r\n            Export all plans\r\n          </button>\r\n          <button class=\"button-green export-button\" @click=\"exportPdfOutlines()\">\r\n            Export all outlines\r\n          </button>\r\n          <button v-if=\"isPremium\" class=\"button-green export-button\" @click=\"exportPdfWorkshops()\">\r\n            Export all workshops\r\n          </button>\r\n        </template>\r\n      </div>\r\n      <div class=\"export-option\">\r\n        <h3>Create a backup</h3>\r\n        <div>(You can recover your document from this file later.)</div>\r\n        <pulse-loader v-if=\"loading\"></pulse-loader>\r\n        <button v-if=\"!loading\" class=\"button-green export-button\" @click=\"exportJsonDocument()\">\r\n          Export entire document\r\n        </button>\r\n      </div>\r\n      <div class=\"export-option\">\r\n        <h3>Import a backup</h3>\r\n        <div>\r\n          (Warning: This will overwrite the current document completely, including all chapters, plans and outlines.)\r\n        </div>\r\n        <div class=\"file-input-container\">\r\n          <pulse-loader v-if=\"loading\"></pulse-loader>\r\n          <template v-if=\"!loading\">\r\n            <label for=\"import-file-picker\" class=\"file-input-label\"></label>\r\n            <input id=\"import-file-picker\" class=\"file-input\" type=\"file\" accept=\".json\" @change=\"setFile\">\r\n            <button class=\"button-green export-button file-dummy-button\">\r\n              Import entire document\r\n            </button>\r\n          </template>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { backupToJsonFile, jsonFileToBackup } from './json'\r\nimport { resetCache } from '../shared/cache'\r\nimport { chaptersToPdf } from './pdf'\r\nimport { CHANGE_DOCUMENT } from '../shared/document.store'\r\nimport PulseLoader from 'vue-spinner/src/PulseLoader.vue'\r\nimport sortBy from 'lodash/sortBy'\r\nimport { storageApiPromise } from '../api/storageSwitch'\r\nimport swal from 'sweetalert'\r\nimport writingWorkshops from '../../../models/writingWorkshop'\r\n\r\nexport default {\r\n  components: {\r\n    PulseLoader\r\n  },\r\n  computed: {\r\n    allChapters () {\r\n      return this.$store.state.chapters.chapters\r\n    },\r\n    allPlans () {\r\n      return this.$store.state.chapters.plans\r\n    },\r\n    allWorkshops () {\r\n      return this.$store.state.workshop.workshops\r\n    },\r\n    documentGuid () {\r\n      return this.$store.state.document.currentDocument.guid\r\n    },\r\n    documentTitle () {\r\n      return this.$store.state.document.currentDocument.name\r\n    },\r\n    isPremium () {\r\n      return this.$store.state.user.user.isPremium\r\n    },\r\n    masterTopics () {\r\n      return this.$store.state.chapters.topics\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      includeArchived: false,\r\n      loading: false\r\n    }\r\n  },\r\n  methods: {\r\n    importBackup (file) {\r\n      this.loading = true\r\n      let backup\r\n      jsonFileToBackup(file).then(_backup => {\r\n        backup = _backup\r\n        backup.guid = this.documentGuid\r\n        backup.name = this.documentTitle\r\n\r\n        return storageApiPromise.then(storage => {\r\n          return storage.docImport(backup)\r\n        })\r\n      }).then(backup => {\r\n        this.loading = false\r\n        resetCache()\r\n\r\n        swal({\r\n          icon: 'success',\r\n          text: 'The document has been imported.',\r\n          title: 'Success'\r\n        }).then(() => {\r\n          return this.$store.dispatch(CHANGE_DOCUMENT,\r\n            { guid: this.documentGuid, name: this.documentTitle }\r\n          )\r\n        })\r\n      }, err => {\r\n        this.loading = false\r\n        swal({\r\n          icon: 'error',\r\n          text: `Could not import the document. DETAILS: \"${err}\"`,\r\n          title: 'Failure'\r\n        })\r\n        throw err\r\n      })\r\n    },\r\n    exportJsonDocument () {\r\n      this.loading = true\r\n\r\n      storageApiPromise.then(storage => {\r\n        return storage.docExport(this.documentGuid, this.documentTitle)\r\n      }).then(backup => {\r\n        backupToJsonFile(this.documentTitle, backup).then(() => {\r\n          this.loading = false\r\n        }, err => {\r\n          this.loading = false\r\n          swal({\r\n            icon: 'error',\r\n            text: `Could not export the document. DETAILS: \"${err}\"`\r\n          })\r\n          throw err\r\n        })\r\n      }, err => {\r\n        this.loading = false\r\n        swal({\r\n          icon: 'error',\r\n          text: `Could not export the document. DETAILS: \"${err}\"`\r\n        })\r\n        throw err\r\n      })\r\n    },\r\n    exportPdfChapters () {\r\n      this.loading = true\r\n\r\n      const chaptersToExport = this.allChapters.filter(chapter =>\r\n        !chapter.archived || this.includeArchived\r\n      )\r\n\r\n      chaptersToPdf(this.documentTitle, chaptersToExport).then(() => {\r\n        this.loading = false\r\n      }, err => {\r\n        this.loading = false\r\n        swal({\r\n          icon: 'error',\r\n          text: `Could not export the document. DETAILS: \"${err}\"`\r\n        })\r\n        throw err\r\n      })\r\n    },\r\n    exportPdfOutlines () {\r\n      this.loading = true\r\n\r\n      const nestedTopics = this.allChapters.filter(chapter =>\r\n        !chapter.archived || this.includeArchived\r\n      ).map(chapter => {\r\n        const chapterTopics = Object.keys(chapter.topics).map(guid => {\r\n          const topic = chapter.topics[guid]\r\n          const masterTopic = this.getMasterTopic(topic)\r\n          topic.archived = masterTopic.archived\r\n          topic.title = `${chapter.title} - ${masterTopic.title}`\r\n          return topic\r\n        }).filter(topic =>\r\n          !topic.archived || this.includeArchived\r\n        )\r\n\r\n        return chapterTopics\r\n      })\r\n\r\n      const topicsArray = [].concat(...nestedTopics)\r\n\r\n      chaptersToPdf(`${this.documentTitle}: Outlines`, topicsArray).then(() => {\r\n        this.loading = false\r\n      }, err => {\r\n        this.loading = false\r\n        swal({\r\n          icon: 'error',\r\n          text: `Could not export outlines. DETAILS: \"${err}\"`\r\n        })\r\n        throw err\r\n      })\r\n    },\r\n    exportPdfPlans () {\r\n      this.loading = true\r\n      const nestedPlans = this.allPlans.filter(plan =>\r\n        !plan.archived || this.includeArchived\r\n      ).map(plan => {\r\n        return plan.sections.filter(section =>\r\n          !section.archived || this.includeArchived\r\n        ).map(section => {\r\n          const title = plan.title === section.title\r\n            ? plan.title\r\n            : `${plan.title} - ${section.title}`\r\n\r\n          return {\r\n            title,\r\n            content: section.content\r\n          }\r\n        })\r\n      })\r\n\r\n      const planArray = [].concat(...nestedPlans)\r\n\r\n      chaptersToPdf(`${this.documentTitle}: Plans`, planArray).then(() => {\r\n        this.loading = false\r\n      }, err => {\r\n        this.loading = false\r\n        swal({\r\n          icon: 'error',\r\n          text: `Could not export plans. DETAILS: \"${err}\"`\r\n        })\r\n        throw err\r\n      })\r\n    },\r\n    exportPdfWorkshops () {\r\n      this.loading = true\r\n      const workshops = this.allWorkshops.filter(workshop =>\r\n        !workshop.archived || this.includeArchived\r\n      ).map(workshop => {\r\n        return {\r\n          content: workshop.content,\r\n          date: workshop.date,\r\n          guid: workshop.guid,\r\n          order: workshop.order,\r\n          title: `${writingWorkshops[workshop.workshopName].displayName} (${workshop.date.toString()})`,\r\n          workshopName: workshop.workshopName\r\n        }\r\n      })\r\n\r\n      const sortedWorkshops = sortBy(workshops, workshop =>\r\n        `${workshop.workshopName}-${workshop.date.toString()}-${workshop.guid}-${workshop.order}`\r\n      )\r\n\r\n      chaptersToPdf(`${this.documentTitle}: Workshops`, sortedWorkshops).then(() => {\r\n        this.loading = false\r\n      }, err => {\r\n        this.loading = false\r\n        swal({\r\n          icon: 'error',\r\n          text: `Could not export workshops. DETAILS: \"${err}\"`\r\n        })\r\n        throw err\r\n      })\r\n    },\r\n    getMasterTopic (chapterTopic) {\r\n      return this.masterTopics.find(topic => topic.guid === chapterTopic.guid)\r\n    },\r\n    setFile (event) {\r\n      swal({\r\n        buttons: true,\r\n        dangerMode: true,\r\n        icon: 'warning',\r\n        text: `Are you sure you want to import this file? It will overwrite everything in the current document.`,\r\n        title: 'Overwrite current document?'\r\n      }).then(willOverwrite => {\r\n        if (!willOverwrite) {\r\n          return\r\n        }\r\n\r\n        this.importBackup(event.target.files[0])\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.wrap {\r\n  display: flex;\r\n  justify-content: center;\r\n  width: 100%;\r\n}\r\n\r\n.exporter {\r\n  display: block;\r\n  flex: 1;\r\n  max-width: 1050px;\r\n}\r\n\r\n.export-option {\r\n  margin-bottom: 16px;\r\n}\r\n\r\n.export-checkbox {\r\n  margin-top: 8px;\r\n}\r\n\r\n.export-button {\r\n  margin: 10px 0;\r\n}\r\n\r\n.file-input-container {\r\n  cursor: pointer;\r\n  display: inline-block;\r\n  position: relative;\r\n}\r\n\r\n.file-input-label {\r\n  bottom: 0;\r\n  cursor: pointer;\r\n  left: 0;\r\n  opacity: 0;\r\n  padding: 0;\r\n  position: absolute;\r\n  right: 0;\r\n  top: 0;\r\n}\r\n\r\n.file-input {\r\n  border: none;\r\n  position: absolute;\r\n  visibility: hidden;\r\n}\r\n\r\n.file-dummy-button {\r\n  pointer-events: none;\r\n}\r\n</style>\r\n","function injectStyle (context) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"minimize\\\":true,\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-4d0eb590\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./exporter.page.vue\")\n}\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./exporter.page.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./exporter.page.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4d0eb590\\\",\\\"hasScoped\\\":true,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./exporter.page.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-4d0eb590\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n","import FileSaver from 'file-saver'\r\n\r\nexport const backupToJsonFile = (title, backup) => {\r\n  return new Promise((resolve) => {\r\n    const json = JSON.stringify(backup)\r\n    const blob = new Blob([json], { type: 'application/json' })\r\n    const today = new Date()\r\n    const date = `${today.getDate()}.${today.getMonth() + 1}.${today.getFullYear()}`\r\n\r\n    if (window && window._integration) {\r\n      window._pdfSuccess = true\r\n      return resolve()\r\n    }\r\n\r\n    FileSaver.saveAs(blob, `${title}--${date}.json`)\r\n    resolve()\r\n  })\r\n}\r\n\r\nexport const jsonFileToBackup = file => {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader()\r\n\r\n    reader.onload = () => {\r\n      try {\r\n        const json = reader.result\r\n        resolve(JSON.parse(json))\r\n      } catch (e) {\r\n        reject(e)\r\n      }\r\n    }\r\n    reader.readAsText(file)\r\n  })\r\n}\r\n"],"sourceRoot":""}