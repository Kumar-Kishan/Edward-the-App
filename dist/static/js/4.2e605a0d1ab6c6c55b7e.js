(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"+XSZ":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.chaptersToPdf=void 0;var o=a(n("m1cH")),r=a(n("4d7F")),i=a(n("5JmO")),c=a(n("TruH")),u=a(n("JEAp")),d=n("dmJm");function a(t){return t&&t.__esModule?t:{default:t}}i.default.vfs=c.default.pdfMake.vfs;e.chaptersToPdf=function(t,e){return new r.default(function(n){var r,c={content:[{text:t,style:"title"}],styles:{body:{fontSize:12},bold:{bold:!0},blockquote:{margin:[10,10,0,10]},chapterHeading:{fontSize:20,margin:[5,10]},h1:{fontSize:18},h2:{fontSize:16},h3:{fontSize:14},italic:{italics:!0},strike:{decoration:"lineThrough"},title:{fontSize:40},underline:{decoration:"underline"}}},a=(0,d.getStyledArrayFromChapters)(e),l=1;a.forEach(function(t){return t.style.includes("ul")?(t.ul=[{text:t.text}],l=1,t.text=null):t.style.includes("ol")?(t.ol=[{text:t.text}],t.start=l++,t.text=null):l=1,t}),c.content=(r=c.content).concat.apply(r,(0,o.default)(a)),i.default.createPdf(c).getBlob(function(e){if(window&&window._integration)return window._pdfSuccess=!0,n();u.default.saveAs(e,t+".pdf"),n()})})}},Kuy8:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=h(n("m1cH")),r=h(n("GQeE")),i=n("aS18"),c=n("fyQS"),u=n("+XSZ"),d=n("j9tD"),a=h(n("il2d")),l=h(n("xweI")),s=n("UUVB"),f=h(n("GUC0")),p=h(n("bFnm"));function h(t){return t&&t.__esModule?t:{default:t}}e.default={components:{PulseLoader:a.default},computed:{allChapters:function(){return this.$store.state.chapters.chapters},allPlans:function(){return this.$store.state.chapters.plans},allWorkshops:function(){return this.$store.state.workshop.workshops},documentGuid:function(){return this.$store.state.document.currentDocument.guid},documentTitle:function(){return this.$store.state.document.currentDocument.name},isPremium:function(){return this.$store.state.user.user.isPremium},masterTopics:function(){return this.$store.state.chapters.topics}},data:function(){return{pdfIncludeArchived:!1,loading:!1,wordIncludeArchived:!1}},methods:{importBackup:function(t){var e=this;this.loading=!0;var n=void 0;(0,i.jsonFileToBackup)(t).then(function(t){return(n=t).guid=e.documentGuid,n.name=e.documentTitle,s.storageApiPromise.then(function(t){return t.docImport(n)})}).then(function(t){e.loading=!1,(0,c.resetCache)(),(0,f.default)({icon:"success",text:"The document has been imported.",title:"Success"}).then(function(){return e.$store.dispatch(d.CHANGE_DOCUMENT,{guid:e.documentGuid,name:e.documentTitle})})},function(t){throw e.loading=!1,(0,f.default)({icon:"error",text:'Could not import the document. DETAILS: "'+t+'"',title:"Failure"}),t})},exportJsonDocument:function(){var t=this;this.loading=!0,s.storageApiPromise.then(function(e){return e.docExport(t.documentGuid,t.documentTitle)}).then(function(e){(0,i.backupToJsonFile)(t.documentTitle,e).then(function(){t.loading=!1},function(e){throw t.loading=!1,(0,f.default)({icon:"error",text:'Could not export the document. DETAILS: "'+e+'"'}),e})},function(e){throw t.loading=!1,(0,f.default)({icon:"error",text:'Could not export the document. DETAILS: "'+e+'"'}),e})},exportPdfChapters:function(){var t=this;this.loading=!0;var e=this.allChapters.filter(function(e){return!e.archived||t.pdfIncludeArchived});(0,u.chaptersToPdf)(this.documentTitle,e).then(function(){t.loading=!1},function(e){throw t.loading=!1,(0,f.default)({icon:"error",text:'Could not export the document. DETAILS: "'+e+'"'}),e})},exportPdfOutlines:function(){var t,e=this;this.loading=!0;var n=this.allChapters.filter(function(t){return!t.archived||e.pdfIncludeArchived}).map(function(t){return(0,r.default)(t.topics).map(function(n){var o=t.topics[n],r=e.getMasterTopic(o);return o.archived=r.archived,o.title=t.title+" - "+r.title,o}).filter(function(t){return!t.archived||e.pdfIncludeArchived})}),i=(t=[]).concat.apply(t,(0,o.default)(n));(0,u.chaptersToPdf)(this.documentTitle+": Outlines",i).then(function(){e.loading=!1},function(t){throw e.loading=!1,(0,f.default)({icon:"error",text:'Could not export outlines. DETAILS: "'+t+'"'}),t})},exportPdfPlans:function(){var t,e=this;this.loading=!0;var n=this.allPlans.filter(function(t){return!t.archived||e.pdfIncludeArchived}).map(function(t){return t.sections.filter(function(t){return!t.archived||e.pdfIncludeArchived}).map(function(e){return{title:t.title===e.title?t.title:t.title+" - "+e.title,content:e.content}})}),r=(t=[]).concat.apply(t,(0,o.default)(n));(0,u.chaptersToPdf)(this.documentTitle+": Plans",r).then(function(){e.loading=!1},function(t){throw e.loading=!1,(0,f.default)({icon:"error",text:'Could not export plans. DETAILS: "'+t+'"'}),t})},exportPdfWorkshops:function(){var t=this;this.loading=!0;var e=this.allWorkshops.filter(function(e){return!e.archived||t.pdfIncludeArchived}).map(function(t){return{content:t.content,date:t.date,guid:t.guid,order:t.order,title:p.default[t.workshopName].displayName+" ("+t.date.toString()+")",workshopName:t.workshopName}}),n=(0,l.default)(e,function(t){return t.workshopName+"-"+t.date.toString()+"-"+t.guid+"-"+t.order});(0,u.chaptersToPdf)(this.documentTitle+": Workshops",n).then(function(){t.loading=!1},function(e){throw t.loading=!1,(0,f.default)({icon:"error",text:'Could not export workshops. DETAILS: "'+e+'"'}),e})},exportWordChapters:function(){var t=this;this.isPremium?(this.loading=!0,s.storageApiPromise.then(function(e){return e.exportToWord({guid:t.documentGuid,title:t.documentTitle,includeArchived:t.wordIncludeArchived})}).then(function(){t.loading=!1},function(e){throw t.loading=!1,(0,f.default)({icon:"error",text:'Could not export to Word. DETAILS: "'+e+'"'}),e})):(0,f.default)({button:"OK",dangerMode:!0,icon:"error",text:"Only Premium users can export to a Microsoft Word document. Please upgrade to a Premium subscription to continue.",title:"Not allowed"})},getMasterTopic:function(t){return this.masterTopics.find(function(e){return e.guid===t.guid})},setFile:function(t){var e=this;(0,f.default)({buttons:!0,dangerMode:!0,icon:"warning",text:"Are you sure you want to import this file? It will overwrite everything in the current document.",title:"Overwrite current document?"}).then(function(n){n&&e.importBackup(t.target.files[0])})}}}},O9dL:function(t,e,n){"use strict";n.r(e);var o=n("Kuy8"),r=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,function(){return o[t]})}(i);var c=n("o9k4"),u=n("JFUb");var d=function(t){n("fUlg")},a=Object(u.a)(r.a,c.a,c.b,!1,d,"data-v-30c0f930",null);e.default=a.exports},aS18:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.jsonFileToBackup=e.backupToJsonFile=void 0;var o=c(n("gDS+")),r=c(n("4d7F")),i=c(n("JEAp"));function c(t){return t&&t.__esModule?t:{default:t}}e.backupToJsonFile=function(t,e){return new r.default(function(n){var r=(0,o.default)(e),c=new Blob([r],{type:"application/json"}),u=new Date,d=u.getDate()+"."+(u.getMonth()+1)+"."+u.getFullYear();if(window&&window._integration)return window._pdfSuccess=!0,n();i.default.saveAs(c,t+"--"+d+".json"),n()})},e.jsonFileToBackup=function(t){return new r.default(function(e,n){var o=new FileReader;o.onload=function(){try{var t=o.result;e(JSON.parse(t))}catch(t){n(t)}},o.readAsText(t)})}},fUlg:function(t,e){},o9k4:function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return r});var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"wrap"},[n("div",{staticClass:"exporter"},[n("div",{staticClass:"export-option"},[n("h3",[t._v("Export to PDF")]),t._v(" "),t.loading?n("pulse-loader"):t._e(),t._v(" "),n("div",{staticClass:"export-checkbox"},[t.loading?t._e():n("input",{directives:[{name:"model",rawName:"v-model",value:t.pdfIncludeArchived,expression:"pdfIncludeArchived"}],attrs:{id:"pdfIncludeArchived",type:"checkbox"},domProps:{checked:Array.isArray(t.pdfIncludeArchived)?t._i(t.pdfIncludeArchived,null)>-1:t.pdfIncludeArchived},on:{change:function(e){var n=t.pdfIncludeArchived,o=e.target,r=!!o.checked;if(Array.isArray(n)){var i=t._i(n,null);o.checked?i<0&&(t.pdfIncludeArchived=n.concat([null])):i>-1&&(t.pdfIncludeArchived=n.slice(0,i).concat(n.slice(i+1)))}else t.pdfIncludeArchived=r}}}),t._v(" "),t.loading?t._e():n("label",{attrs:{for:"pdfIncludeArchived"}},[t._v("Include Archived")])]),t._v(" "),t.loading?t._e():[n("button",{staticClass:"button-green export-button",on:{click:function(e){t.exportPdfChapters()}}},[t._v("\n          Export all chapters\n        ")]),t._v(" "),n("button",{staticClass:"button-green export-button",on:{click:function(e){t.exportPdfPlans()}}},[t._v("\n          Export all plans\n        ")]),t._v(" "),n("button",{staticClass:"button-green export-button",on:{click:function(e){t.exportPdfOutlines()}}},[t._v("\n          Export all outlines\n        ")]),t._v(" "),t.isPremium?n("button",{staticClass:"button-green export-button",on:{click:function(e){t.exportPdfWorkshops()}}},[t._v("\n          Export all workshops\n        ")]):t._e()]],2),t._v(" "),n("div",{staticClass:"export-option"},[n("h3",[t._v("Export to Microsoft Word document")]),t._v(" "),n("div",[t._v("(Premium users only)")]),t._v(" "),t.loading?n("pulse-loader"):t._e(),t._v(" "),n("div",{staticClass:"export-checkbox"},[t.loading?t._e():n("input",{directives:[{name:"model",rawName:"v-model",value:t.wordIncludeArchived,expression:"wordIncludeArchived"}],attrs:{id:"wordIncludeArchived",type:"checkbox"},domProps:{checked:Array.isArray(t.wordIncludeArchived)?t._i(t.wordIncludeArchived,null)>-1:t.wordIncludeArchived},on:{change:function(e){var n=t.wordIncludeArchived,o=e.target,r=!!o.checked;if(Array.isArray(n)){var i=t._i(n,null);o.checked?i<0&&(t.wordIncludeArchived=n.concat([null])):i>-1&&(t.wordIncludeArchived=n.slice(0,i).concat(n.slice(i+1)))}else t.wordIncludeArchived=r}}}),t._v(" "),t.loading?t._e():n("label",{attrs:{for:"wordIncludeArchived"}},[t._v("Include Archived")])]),t._v(" "),t.loading?t._e():[n("button",{staticClass:"button-green export-button",on:{click:function(e){t.exportWordChapters()}}},[t._v("\n          Export all chapters\n        ")])]],2),t._v(" "),n("div",{staticClass:"export-option"},[n("h3",[t._v("Create a backup")]),t._v(" "),n("div",[t._v("(You can recover your document from this file later.)")]),t._v(" "),t.loading?n("pulse-loader"):t._e(),t._v(" "),t.loading?t._e():n("button",{staticClass:"button-green export-button",on:{click:function(e){t.exportJsonDocument()}}},[t._v("\n        Export entire document\n      ")])],1),t._v(" "),n("div",{staticClass:"export-option"},[n("h3",[t._v("Import a backup")]),t._v(" "),n("div",[t._v("\n        (Warning: This will overwrite the current document completely, including all chapters, plans, outlines and workshops.)\n      ")]),t._v(" "),n("div",{staticClass:"file-input-container"},[t.loading?n("pulse-loader"):t._e(),t._v(" "),t.loading?t._e():[n("label",{staticClass:"file-input-label",attrs:{for:"import-file-picker"}}),t._v(" "),n("input",{staticClass:"file-input",attrs:{id:"import-file-picker",type:"file",accept:".json"},on:{change:t.setFile}}),t._v(" "),n("button",{staticClass:"button-green export-button file-dummy-button"},[t._v("\n            Import entire document\n          ")])]],2)])])])},r=[]}}]);
//# sourceMappingURL=4.2e605a0d1ab6c6c55b7e.js.map