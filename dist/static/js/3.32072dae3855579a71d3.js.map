{"version":3,"sources":["webpack:///./src/app/exporter/exporter.page.vue?7bf1","webpack:///./src/app/exporter/exporter.page.vue?9eea","webpack:///./src/app/exporter/pdf.js","webpack:///src/app/exporter/exporter.page.vue","webpack:///./src/app/exporter/json.js","webpack:///./src/app/exporter/exporter.page.vue","webpack:///./src/app/exporter/exporter.page.vue?7e99"],"names":["content","__webpack_require__","module","i","locals","exports","add","default","push","version","sources","names","mappings","file","sourcesContent","sourceRoot","pdf_chaptersToPdf","title","chapters","promise_default","a","resolve","_definition$content","definition","text","style","styles","body","fontSize","bold","blockquote","margin","chapterHeading","h1","h2","h3","italic","italics","strike","decoration","underline","splitContent","getNewSegment","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","get_iterator_default","next","done","chapter","value","pageBreak","currentLine","ops","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","_currentLine$style","op","insert","_getStyles","pdf_getStyles","attributes","lineStyles","length","apply","toConsumableArray_default","includes","_insert$split","split","_insert$split2","toArray_default","first","lines","slice","segment","ix","err","return","counter","forEach","ul","ol","start","concat","pdfmake_min_default","createPdf","download","pdf_listMap","bullet","ordered","attr","exporter_page","PulseLoader","plans","topics","guid","name","isPremium","_this","this","backup","reject","reader","FileReader","onload","json","result","JSON","parse","e","readAsText","_backup","documentGuid","documentTitle","Object","cache","then","document_store","_this2","stringify_default","blob","Blob","type","today","Date","date","getDate","getMonth","getFullYear","FileSaver_default","saveAs","_this3","archived","includeArchived","_this4","topic","nestedTopics","_this5","plan","section","nestedPlans","_this6","willOverwrite","exporter_page_vue_styles_","context","exporter_page_Component","component_normalizer","_vm","_h","$createElement","_c","_self","staticClass","_v","_e","loading","directives","rawName","expression","attrs","id","domProps","checked","Array","isArray","_i","on","change","$event","$$a","$$el","target","$$c","$$i","for","click","exportPdfChapters","exportPdfPlans","exportPdfOutlines","exportJsonDocument","accept","setFile","__webpack_exports__"],"mappings":"gFAGA,IAAAA,EAAAC,EAAA,QACA,iBAAAD,QAAAE,EAAAC,EAAAH,EAAA,MACAA,EAAAI,SAAAF,EAAAG,QAAAL,EAAAI,SAGAE,EADAL,EAAA,QAAAM,SACA,WAAAP,GAAA,+BCRAE,EAAAG,QAAAJ,EAAA,OAAAA,EAAA,IAKAO,MAAAN,EAAAC,EAAA,uuBAA8vB,IAAQM,QAAA,EAAAC,SAAA,6DAAAC,SAAAC,SAAA,mcAAAC,KAAA,oBAAAC,gBAAA,4gCAA+lDC,WAAA,wOCJr2Ed,EAAQ,QAED,IAAMe,EAAgB,SAACC,EAAOC,GACnC,OAAO,IAAAC,EAAAC,EAAY,SAACC,GAAY,IAAAC,EACxBC,GACJvB,UACEwB,KAAMP,EACNQ,MAAO,UAETC,QACEC,MACEC,SAAU,IAEZC,MACEA,MAAM,GAERC,YACEC,QAAS,GAAI,GAAI,EAAG,KAEtBC,gBACEJ,SAAU,GACVG,QAAS,EAAG,KAEdE,IACEL,SAAU,IAEZM,IACEN,SAAU,IAEZO,IACEP,SAAU,IAEZQ,QACEC,SAAS,GAEXC,QACEC,WAAY,eAEdtB,OACEW,SAAU,IAEZY,WACED,WAAY,eAKZE,KASN,SAASC,EAAelB,EAAMC,GAC5B,OACED,KAAMA,GAAQ,GACdC,MAAOA,OAxDmB,IAAAkB,GAAA,EAAAC,GAAA,EAAAC,OAAAC,EAAA,IA4D9B,QAAAC,EAAAC,EAAAC,IAAsB/B,KAAtByB,GAAAI,EAAAC,EAAAE,QAAAC,MAAAR,GAAA,EAAgC,KAArBS,EAAqBL,EAAAM,MAC9BZ,EAAajC,MACXgB,KAAM4B,EAAQnC,MACdQ,MAAO,iBACP6B,UAAW,WAGb,IAAIC,GAnBF/B,QACAC,UAmBI+B,EAAOJ,EAAQpD,SAAWoD,EAAQpD,QAAQwD,QARlBC,GAAA,EAAAC,GAAA,EAAAC,OAAAb,EAAA,IAS9B,QAAAc,EAAAC,EAAAZ,IAAiBO,KAAjBC,GAAAG,EAAAC,EAAAX,QAAAC,MAAAM,GAAA,EAAsB,KAIGK,EAJdC,EAAWH,EAAAP,MACdW,EAASD,EAAGC,OADEC,EAEWC,EAAUH,EAAGI,YAApCzC,EAFYuC,EAEZvC,OAAQ0C,EAFIH,EAEJG,WAEhB,GAAIA,EAAWC,QACbP,EAAAP,EAAY9B,OAAMjB,KAAlB8D,MAAAR,EAAAS,IAA0BH,IAG5B,GAAe,OAAXJ,EAMJ,GAAIA,EAAOQ,SAAS,MAApB,CAA2B,IAAAC,EACCT,EAAOU,MAAM,MADdC,EAAAC,IAAAH,GAClBI,EADkBF,EAAA,GACRG,EADQH,EAAAI,MAAA,GAEzB,GAAIF,EAAO,CACT,IAAMG,EAAUtC,EAAcmC,EAAOnD,GACrC6B,EAAY/B,KAAKhB,KAAKwE,GAGxBvC,EAAajC,KAAK+C,GAClBA,GA3CF/B,QACAC,UA4CE,IAAK,IAAIwD,EAAK,EAAGA,EAAKH,EAAMT,OAAS,EAAGY,IAAM,CAC5C,IACMD,EAAUtC,EADHoC,EAAMG,GACiBvD,GACpC6B,EAAY/B,KAAKhB,KAAKwE,GAEtBvC,EAAajC,KAAK+C,GAClBA,GAnDJ/B,QACAC,UAqDE,IACMuD,EAAUtC,EADHoC,EAAMA,EAAMT,OAAS,GACE3C,GACpC6B,EAAY/B,KAAKhB,KAAKwE,OArBxB,CA0BA,IAAMA,EAAUtC,EAAcsB,EAAQtC,GACtC6B,EAAY/B,KAAKhB,KAAKwE,QAhCpBvC,EAAajC,KAAK+C,GAClBA,GA/BF/B,QACAC,WAW4B,MAAAyD,GAAAxB,GAAA,EAAAC,EAAAuB,EAAA,aAAAzB,GAAAI,EAAAsB,QAAAtB,EAAAsB,SAAA,WAAAzB,EAAA,MAAAC,KA5DF,MAAAuB,GAAAtC,GAAA,EAAAC,EAAAqC,EAAA,aAAAvC,GAAAK,EAAAmC,QAAAnC,EAAAmC,SAAA,WAAAvC,EAAA,MAAAC,GAkH9B,IAAIuC,EAAU,EACd3C,EAAa4C,QAAQ,SAAArF,GAYnB,OAXIA,EAAQyB,MAAM+C,SAAS,OACzBxE,EAAQsF,KAAQ9D,KAAMxB,EAAQwB,OAC9B4D,EAAU,EACVpF,EAAQwB,KAAO,MACNxB,EAAQyB,MAAM+C,SAAS,OAChCxE,EAAQuF,KAAQ/D,KAAMxB,EAAQwB,OAC9BxB,EAAQwF,MAAQJ,IAChBpF,EAAQwB,KAAO,MAEf4D,EAAU,EAELpF,IAGTuB,EAAWvB,SAAUsB,EAAAC,EAAWvB,SAAQyF,OAAnBnB,MAAAhD,EAA6BmB,GAElDiD,EAAAtE,EAAQuE,UAAUpE,GAAYqE,SAAY3E,EAA1C,QACAI,OAIEwE,GACJC,OAAU,KACVC,QAAW,MAEb,SAAS7B,EAAWC,GAClB,IAAMzC,KACA0C,KAEN,IAAKD,EACH,OAASzC,SAAQ0C,cAGnB,IAAK,IAAM4B,KAAQ7B,GACZ,OAAQ,SAAU,YAAa,UAAUK,SAASwB,GACrDtE,EAAOlB,KAAKwF,GAID,WAATA,EAKS,eAATA,EAKS,SAATA,GACF5B,EAAW5D,KAAKqF,EAAQ1B,EAAW6B,KALnC5B,EAAW5D,KAAK,cALhB4D,EAAW5D,KAAX,IAAoB2D,EAAW6B,IAenC,OAAStE,SAAQ0C,2ECrHnB6B,eAIAC,cAAA,sEAGAhF,gEAGAiF,8DAGAC,kFAGAC,iFAGAC,8DAGAC,qEAGAH,iDAKA,WAEA,sCAGA,IAAAI,EAAAC,mBACA,MACAC,OAAA,GClFgC,SAAA7F,GAC9B,OAAO,IAAAM,EAAAC,EAAY,SAACC,EAASsF,GAC3B,IAAMC,EAAS,IAAIC,WAEnBD,EAAOE,OAAS,WACd,IACE,IAAMC,EAAOH,EAAOI,OACpB3F,EAAQ4F,KAAKC,MAAMH,IACnB,MAAOI,GACPR,EAAOQ,KAGXP,EAAOQ,WAAWvG,oCDwEtBwG,UACAC,sBAEAC,sDAEAb,mCAGA,EAEAc,OAAAC,EAAA,EAAAD,aAEA,eACA,wCACA,YAHAE,KAAA,oCAKAC,EAAA,GAAAtB,KAAAG,EAAAc,aAAAhB,KAAAE,EAEAe,gDAGA,YAEA,yDACArC,EAAA,UAEA,YACAA,mCAGA,IAAA0C,EAAAnB,mBAEA,2DAEAc,mCCjIgC,SAACtG,EAAOyF,GACtC,OAAO,IAAAvF,EAAAC,EAAY,SAACC,GAClB,IAAM0F,EAAOc,IAAenB,GACtBoB,EAAO,IAAIC,MAAMhB,IAASiB,KAAM,qBAChCC,EAAQ,IAAIC,KACZC,EAAUF,EAAMG,UAAhB,KAA6BH,EAAMI,WAAa,GAAhD,IAAqDJ,EAAMK,cACjEC,EAAAnH,EAAUoH,OAAOV,EAAS7G,EAA1B,KAAoCkH,EAApC,SACA9G,sDD6HJ,gCAEA,YAEA,yDAEA6D,EAAA,MACAA,oCAIA,IAAAuD,EAAAhC,mBAEA,4CACA,OAAArD,EAAAsF,UAAAD,EAGAE,qEAEA,gCAEA,YAEA,yDAEAzD,EAAA,MACAA,kCAGA,MAAA0D,EAAAnC,mBAEA,4CACA,OAAArD,EAAAsF,UAAAE,EACAD,sFAGAtC,sBACAwC,uBACAH,iCACAzH,MACA4H,uBACA,OAAAA,EAAAH,UAAAE,EAGAD,gDAKAG,oEAEA,gCAEA,YAEA,qDAEA5D,EAAA,MACAA,+BAGA,MAAA6D,EAAAtC,mBACA,yCACA,OAAAuC,EAAAN,UAAAK,EACAJ,uEAEA,OAAAM,EAAAP,UAAAK,EACAJ,yCAOA1H,kBALAA,MAAA+H,EACA/H,MAAA+H,EAAA/H,MAAA,MAAAgI,EAEAhI,gBAIAjB,yCAKAkJ,iEAEA,gCAEA,YAEA,kDAEAhE,EAAA,MACAA,4FAIAmB,4BAEA,IAAA8C,EAAA1C,mBAEA,cACA,OACA,UACAjF,KAAA,yGACA,gCALAkG,KAAA,SAAA0B,oCAWA,qBEzOA,IAEAC,EAXA,SAAAC,GACArJ,EAAA,SAgBAsJ,EAAA/B,OAAAgC,EAAA,EAAAhC,CACAvB,EClBA,WAA0B,IAAAwD,EAAAhD,KAAaiD,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,SAAmBF,EAAA,OAAYE,YAAA,aAAuBF,EAAA,OAAYE,YAAA,kBAA4BF,EAAA,MAAAH,EAAAM,GAAA,mBAAAN,EAAAM,GAAA,KAAAH,EAAA,OAAAH,EAAAM,GAAA,4CAAAN,EAAAM,GAAA,KAAAN,EAAA,QAAAG,EAAA,gBAAAH,EAAAO,KAAAP,EAAAM,GAAA,KAAAH,EAAA,OAA0LE,YAAA,oBAA8BL,EAAAQ,QAA0nBR,EAAAO,KAA1nBJ,EAAA,SAA6BM,aAAa5D,KAAA,QAAA6D,QAAA,UAAA9G,MAAAoG,EAAA,gBAAAW,WAAA,oBAAwFC,OAASC,GAAA,kBAAAtC,KAAA,YAAyCuC,UAAWC,QAAAC,MAAAC,QAAAjB,EAAAd,iBAAAc,EAAAkB,GAAAlB,EAAAd,gBAAA,SAAAc,EAAA,iBAAuGmB,IAAKC,OAAA,SAAAC,GAA0B,IAAAC,EAAAtB,EAAAd,gBAAAqC,EAAAF,EAAAG,OAAAC,IAAAF,EAAAR,QAA+E,GAAAC,MAAAC,QAAAK,GAAA,CAAuB,IAAAI,EAAA1B,EAAAkB,GAAAI,EAAA,MAAiCC,EAAAR,QAAiBW,EAAA,IAAA1B,EAAAd,gBAAAoC,EAAAtF,QAAlD,QAAsG0F,GAAA,IAAA1B,EAAAd,gBAAAoC,EAAAhG,MAAA,EAAAoG,GAAA1F,OAAAsF,EAAAhG,MAAAoG,EAAA,UAA8E1B,EAAAd,gBAAAuC,MAA2BzB,EAAAM,GAAA,KAAAN,EAAAQ,QAAkFR,EAAAO,KAAlFJ,EAAA,SAAkDS,OAAOe,IAAA,qBAAyB3B,EAAAM,GAAA,wBAAAN,EAAAM,GAAA,KAAAN,EAAAQ,QAAkLR,EAAAO,KAAlLJ,EAAA,UAAkFE,YAAA,6BAAAc,IAA6CS,MAAA,SAAAP,GAAyBrB,EAAA6B,wBAA0B7B,EAAAM,GAAA,2CAAAN,EAAAM,GAAA,KAAAN,EAAAQ,QAAkMR,EAAAO,KAAlMJ,EAAA,UAAqGE,YAAA,6BAAAc,IAA6CS,MAAA,SAAAP,GAAyBrB,EAAA8B,qBAAuB9B,EAAAM,GAAA,wCAAAN,EAAAM,GAAA,KAAAN,EAAAQ,QAAkMR,EAAAO,KAAlMJ,EAAA,UAAkGE,YAAA,6BAAAc,IAA6CS,MAAA,SAAAP,GAAyBrB,EAAA+B,wBAA0B/B,EAAAM,GAAA,+CAAAN,EAAAM,GAAA,KAAAH,EAAA,OAAuFE,YAAA,kBAA4BF,EAAA,MAAAH,EAAAM,GAAA,qBAAAN,EAAAM,GAAA,KAAAH,EAAA,OAAAH,EAAAM,GAAA,2DAAAN,EAAAM,GAAA,KAAAN,EAAA,QAAAG,EAAA,gBAAAH,EAAAO,KAAAP,EAAAM,GAAA,KAAAN,EAAAQ,QAA8TR,EAAAO,KAA9TJ,EAAA,UAA6NE,YAAA,6BAAAc,IAA6CS,MAAA,SAAAP,GAAyBrB,EAAAgC,yBAA2BhC,EAAAM,GAAA,kDAAAN,EAAAM,GAAA,KAAAH,EAAA,OAA0FE,YAAA,kBAA4BF,EAAA,MAAAH,EAAAM,GAAA,qBAAAN,EAAAM,GAAA,KAAAH,EAAA,OAAAH,EAAAM,GAAA,mIAAAN,EAAAM,GAAA,KAAAH,EAAA,OAA6NE,YAAA,yBAAmCL,EAAA,QAAAG,EAAA,gBAAAH,EAAAO,KAAAP,EAAAM,GAAA,KAAAN,EAAAQ,QAA0XR,EAAAO,MAA1XJ,EAAA,SAAoFE,YAAA,mBAAAO,OAAsCe,IAAA,wBAA4B3B,EAAAM,GAAA,KAAAH,EAAA,SAA0BE,YAAA,aAAAO,OAAgCC,GAAA,qBAAAtC,KAAA,OAAA0D,OAAA,SAAyDd,IAAKC,OAAApB,EAAAkC,WAAsBlC,EAAAM,GAAA,KAAAH,EAAA,UAA2BE,YAAA,iDAA2DL,EAAAM,GAAA,sEDSn0F,EAaAV,EATA,kBAEA,MAYAuC,EAAA,QAAArC,EAAA","file":"static/js/3.32072dae3855579a71d3.js","sourcesContent":["// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/index.js?{\\\"minimize\\\":true,\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index.js?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-26e78664\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!../../../node_modules/vue-loader/lib/selector.js?type=styles&index=0!./exporter.page.vue\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"1c89a9f6\", content, true, {});","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(true);\n// imports\n\n\n// module\nexports.push([module.id, \".wrap[data-v-26e78664]{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:100%}.exporter[data-v-26e78664]{display:block;-webkit-box-flex:1;-ms-flex:1;flex:1;max-width:1050px}.export-option[data-v-26e78664]{margin-bottom:16px}.export-checkbox[data-v-26e78664]{margin-top:8px}.export-button[data-v-26e78664]{margin:10px 0}.file-input-container[data-v-26e78664]{cursor:pointer;display:inline-block;position:relative}.file-input-label[data-v-26e78664]{bottom:0;cursor:pointer;left:0;opacity:0;padding:0;position:absolute;right:0;top:0}.file-input[data-v-26e78664]{border:none;position:absolute;visibility:hidden}.file-dummy-button[data-v-26e78664]{pointer-events:none}\", \"\", {\"version\":3,\"sources\":[\"C:/code/Edward-the-App/src/app/exporter/exporter.page.vue\"],\"names\":[],\"mappings\":\"AACA,uBACE,oBAAqB,AACrB,oBAAqB,AACrB,aAAc,AACd,wBAAyB,AACrB,qBAAsB,AAClB,uBAAwB,AAChC,UAAY,CACb,AACD,2BACE,cAAe,AACf,mBAAoB,AAChB,WAAY,AACR,OAAQ,AAChB,gBAAkB,CACnB,AACD,gCACE,kBAAoB,CACrB,AACD,kCACE,cAAgB,CACjB,AACD,gCACE,aAAe,CAChB,AACD,uCACE,eAAgB,AAChB,qBAAsB,AACtB,iBAAmB,CACpB,AACD,mCACE,SAAU,AACV,eAAgB,AAChB,OAAQ,AACR,UAAW,AACX,UAAW,AACX,kBAAmB,AACnB,QAAS,AACT,KAAO,CACR,AACD,6BACE,YAAa,AACb,kBAAmB,AACnB,iBAAmB,CACpB,AACD,oCACE,mBAAqB,CACtB\",\"file\":\"exporter.page.vue\",\"sourcesContent\":[\"\\n.wrap[data-v-26e78664] {\\r\\n  display: -webkit-box;\\r\\n  display: -ms-flexbox;\\r\\n  display: flex;\\r\\n  -webkit-box-pack: center;\\r\\n      -ms-flex-pack: center;\\r\\n          justify-content: center;\\r\\n  width: 100%;\\n}\\n.exporter[data-v-26e78664] {\\r\\n  display: block;\\r\\n  -webkit-box-flex: 1;\\r\\n      -ms-flex: 1;\\r\\n          flex: 1;\\r\\n  max-width: 1050px;\\n}\\n.export-option[data-v-26e78664] {\\r\\n  margin-bottom: 16px;\\n}\\n.export-checkbox[data-v-26e78664] {\\r\\n  margin-top: 8px;\\n}\\n.export-button[data-v-26e78664] {\\r\\n  margin: 10px 0;\\n}\\n.file-input-container[data-v-26e78664] {\\r\\n  cursor: pointer;\\r\\n  display: inline-block;\\r\\n  position: relative;\\n}\\n.file-input-label[data-v-26e78664] {\\r\\n  bottom: 0;\\r\\n  cursor: pointer;\\r\\n  left: 0;\\r\\n  opacity: 0;\\r\\n  padding: 0;\\r\\n  position: absolute;\\r\\n  right: 0;\\r\\n  top: 0;\\n}\\n.file-input[data-v-26e78664] {\\r\\n  border: none;\\r\\n  position: absolute;\\r\\n  visibility: hidden;\\n}\\n.file-dummy-button[data-v-26e78664] {\\r\\n  pointer-events: none;\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n\n// exports\n","import pdfMake from 'pdfmake/build/pdfmake.min'\r\nrequire('imports-loader?this=>window!pdfmake/build/vfs_fonts.js')\r\n\r\nexport const chaptersToPdf = (title, chapters) => {\r\n  return new Promise((resolve) => {\r\n    const definition = {\r\n      content: [{\r\n        text: title,\r\n        style: 'title'\r\n      }],\r\n      styles: {\r\n        body: {\r\n          fontSize: 12\r\n        },\r\n        bold: {\r\n          bold: true\r\n        },\r\n        blockquote: {\r\n          margin: [10, 10, 0, 10]\r\n        },\r\n        chapterHeading: {\r\n          fontSize: 20,\r\n          margin: [5, 10]\r\n        },\r\n        h1: {\r\n          fontSize: 18\r\n        },\r\n        h2: {\r\n          fontSize: 16\r\n        },\r\n        h3: {\r\n          fontSize: 14\r\n        },\r\n        italic: {\r\n          italics: true\r\n        },\r\n        strike: {\r\n          decoration: 'lineThrough'\r\n        },\r\n        title: {\r\n          fontSize: 40\r\n        },\r\n        underline: {\r\n          decoration: 'underline'\r\n        }\r\n      }\r\n    }\r\n\r\n    const splitContent = []\r\n\r\n    function getNewLine () {\r\n      return {\r\n        text: [],\r\n        style: []\r\n      }\r\n    }\r\n\r\n    function getNewSegment (text, style) {\r\n      return {\r\n        text: text || '',\r\n        style: style || []\r\n      }\r\n    }\r\n\r\n    for (const chapter of chapters) {\r\n      splitContent.push({\r\n        text: chapter.title,\r\n        style: 'chapterHeading',\r\n        pageBreak: 'before'\r\n      })\r\n\r\n      let currentLine = getNewLine()\r\n      const ops = (chapter.content && chapter.content.ops) || []\r\n      for (const op of ops) {\r\n        const insert = op.insert\r\n        const { styles, lineStyles } = getStyles(op.attributes)\r\n\r\n        if (lineStyles.length) {\r\n          currentLine.style.push(...lineStyles)\r\n        }\r\n\r\n        if (insert === '\\n') {\r\n          splitContent.push(currentLine)\r\n          currentLine = getNewLine()\r\n          continue\r\n        }\r\n\r\n        if (insert.includes('\\n')) {\r\n          const [first, ...lines] = insert.split('\\n')\r\n          if (first) {\r\n            const segment = getNewSegment(first, styles)\r\n            currentLine.text.push(segment)\r\n          }\r\n\r\n          splitContent.push(currentLine)\r\n          currentLine = getNewLine()\r\n\r\n          for (let ix = 0; ix < lines.length - 1; ix++) {\r\n            const line = lines[ix]\r\n            const segment = getNewSegment(line, styles)\r\n            currentLine.text.push(segment)\r\n\r\n            splitContent.push(currentLine)\r\n            currentLine = getNewLine()\r\n          }\r\n\r\n          const last = lines[lines.length - 1]\r\n          const segment = getNewSegment(last, styles)\r\n          currentLine.text.push(segment)\r\n\r\n          continue\r\n        }\r\n\r\n        const segment = getNewSegment(insert, styles)\r\n        currentLine.text.push(segment)\r\n      }\r\n    }\r\n\r\n    let counter = 1\r\n    splitContent.forEach(content => {\r\n      if (content.style.includes('ul')) {\r\n        content.ul = [{ text: content.text }]\r\n        counter = 1\r\n        content.text = null\r\n      } else if (content.style.includes('ol')) {\r\n        content.ol = [{ text: content.text }]\r\n        content.start = counter++\r\n        content.text = null\r\n      } else {\r\n        counter = 1\r\n      }\r\n      return content\r\n    })\r\n\r\n    definition.content = definition.content.concat(...splitContent)\r\n\r\n    pdfMake.createPdf(definition).download(`${title}.pdf`)\r\n    resolve()\r\n  })\r\n}\r\n\r\nconst listMap = {\r\n  'bullet': 'ul',\r\n  'ordered': 'ol'\r\n}\r\nfunction getStyles (attributes) {\r\n  const styles = []\r\n  const lineStyles = []\r\n\r\n  if (!attributes) {\r\n    return { styles, lineStyles }\r\n  }\r\n\r\n  for (const attr in attributes) {\r\n    if (['bold', 'italic', 'underline', 'strike'].includes(attr)) {\r\n      styles.push(attr)\r\n      continue\r\n    }\r\n\r\n    if (attr === 'header') {\r\n      lineStyles.push(`h${attributes[attr]}`)\r\n      continue\r\n    }\r\n\r\n    if (attr === 'blockquote') {\r\n      lineStyles.push('blockquote')\r\n      continue\r\n    }\r\n\r\n    if (attr === 'list') {\r\n      lineStyles.push(listMap[attributes[attr]])\r\n      continue\r\n    }\r\n  }\r\n\r\n  return { styles, lineStyles }\r\n}\r\n","<template>\r\n  <div class=\"wrap\">\r\n    <div class=\"exporter\">\r\n      <div class=\"export-option\">\r\n        <h3>Export to PDF</h3>\r\n        <div>(You can open PDFs in Microsoft Word.)</div>\r\n        <pulse-loader v-if=\"loading\"></pulse-loader>\r\n        <div class=\"export-checkbox\">\r\n          <input id=\"includeArchived\" v-if=\"!loading\" type=\"checkbox\" v-model=\"includeArchived\">\r\n          <label for=\"includeArchived\" v-if=\"!loading\">Include Archived</label>\r\n        </div>\r\n        <button v-if=\"!loading\" class=\"button-green export-button\" @click=\"exportPdfChapters()\">\r\n          Export all chapters\r\n        </button>\r\n        <button v-if=\"!loading\" class=\"button-green export-button\" @click=\"exportPdfPlans()\">\r\n          Export all plans\r\n        </button>\r\n        <button v-if=\"!loading\" class=\"button-green export-button\" @click=\"exportPdfOutlines()\">\r\n          Export all outlines\r\n        </button>\r\n      </div>\r\n      <div class=\"export-option\">\r\n        <h3>Create a backup</h3>\r\n        <div>(You can recover your document from this file later.)</div>\r\n        <pulse-loader v-if=\"loading\"></pulse-loader>\r\n        <button v-if=\"!loading\" class=\"button-green export-button\" @click=\"exportJsonDocument()\">\r\n          Export entire document\r\n        </button>\r\n      </div>\r\n      <div class=\"export-option\">\r\n        <h3>Import a backup</h3>\r\n        <div>\r\n          (Warning: This will overwrite the current document completely, including all chapters, plans and outlines.)\r\n        </div>\r\n        <div class=\"file-input-container\">\r\n          <pulse-loader v-if=\"loading\"></pulse-loader>\r\n          <template v-if=\"!loading\">\r\n            <label for=\"import-file-picker\" class=\"file-input-label\"></label>\r\n            <input id=\"import-file-picker\" class=\"file-input\" type=\"file\" accept=\".json\" @change=\"setFile\">\r\n            <button class=\"button-green export-button file-dummy-button\">\r\n              Import entire document\r\n            </button>\r\n          </template>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { backupToJsonFile, jsonFileToBackup } from './json'\r\nimport { resetCache } from '../shared/cache'\r\nimport { chaptersToPdf } from './pdf'\r\nimport { CHANGE_DOCUMENT } from '../shared/document.store'\r\nimport PulseLoader from 'vue-spinner/src/PulseLoader.vue'\r\nimport { storageApiPromise } from '../api/storageSwitch'\r\nimport swal from 'sweetalert'\r\n\r\nexport default {\r\n  components: {\r\n    PulseLoader\r\n  },\r\n  computed: {\r\n    allChapters () {\r\n      return this.$store.state.chapters.chapters\r\n    },\r\n    allPlans () {\r\n      return this.$store.state.chapters.plans\r\n    },\r\n    allTopics () {\r\n      return this.$store.state.chapters.topics\r\n    },\r\n    documentGuid () {\r\n      return this.$store.state.document.currentDocument.guid\r\n    },\r\n    documentTitle () {\r\n      return this.$store.state.document.currentDocument.name\r\n    },\r\n    isPremium () {\r\n      return this.$store.state.user.user.isPremium\r\n    },\r\n    masterTopics () {\r\n      return this.$store.state.chapters.topics\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      includeArchived: false,\r\n      loading: false\r\n    }\r\n  },\r\n  methods: {\r\n    importBackup (file) {\r\n      this.loading = true\r\n      let backup\r\n      jsonFileToBackup(file).then(_backup => {\r\n        backup = _backup\r\n        backup.guid = this.documentGuid\r\n        backup.name = this.documentTitle\r\n\r\n        return storageApiPromise.then(storage => {\r\n          return storage.docImport(backup)\r\n        })\r\n      }).then(backup => {\r\n        this.loading = false\r\n        resetCache()\r\n\r\n        swal({\r\n          icon: 'success',\r\n          text: 'The document has been imported.',\r\n          title: 'Success'\r\n        }).then(() => {\r\n          return this.$store.dispatch(CHANGE_DOCUMENT,\r\n            { guid: this.documentGuid, name: this.documentTitle }\r\n          )\r\n        })\r\n      }, err => {\r\n        this.loading = false\r\n        swal({\r\n          icon: 'error',\r\n          text: `Could not import the document. DETAILS: \"${err}\"`,\r\n          title: 'Failure'\r\n        })\r\n        throw err\r\n      })\r\n    },\r\n    exportJsonDocument () {\r\n      this.loading = true\r\n\r\n      storageApiPromise.then(storage => {\r\n        return storage.docExport(this.documentGuid, this.documentTitle)\r\n      }).then(backup => {\r\n        backupToJsonFile(this.documentTitle, backup).then(() => {\r\n          this.loading = false\r\n        }, err => {\r\n          this.loading = false\r\n          swal({\r\n            icon: 'error',\r\n            text: `Could not export the document. DETAILS: \"${err}\"`\r\n          })\r\n          throw err\r\n        })\r\n      })\r\n    },\r\n    exportPdfChapters () {\r\n      this.loading = true\r\n\r\n      const chaptersToExport = this.allChapters.filter(chapter =>\r\n        !chapter.archived || this.includeArchived\r\n      )\r\n\r\n      chaptersToPdf(this.documentTitle, chaptersToExport).then(() => {\r\n        this.loading = false\r\n      }, err => {\r\n        this.loading = false\r\n        swal({\r\n          icon: 'error',\r\n          text: `Could not export the document. DETAILS: \"${err}\"`\r\n        })\r\n        throw err\r\n      })\r\n    },\r\n    exportPdfOutlines () {\r\n      this.loading = true\r\n\r\n      const nestedTopics = this.allChapters.filter(chapter =>\r\n        !chapter.archived || this.includeArchived\r\n      ).map(chapter => {\r\n        const chapterTopics = Object.keys(chapter.topics).map(guid => {\r\n          const topic = chapter.topics[guid]\r\n          const masterTopic = this.getMasterTopic(topic)\r\n          topic.archived = masterTopic.archived\r\n          topic.title = `${chapter.title} - ${masterTopic.title}`\r\n          return topic\r\n        }).filter(topic =>\r\n          !topic.archived || this.includeArchived\r\n        )\r\n\r\n        return chapterTopics\r\n      })\r\n\r\n      const topicsArray = [].concat(...nestedTopics)\r\n\r\n      chaptersToPdf(`${this.documentTitle}: Outlines`, topicsArray).then(() => {\r\n        this.loading = false\r\n      }, err => {\r\n        this.loading = false\r\n        swal({\r\n          icon: 'error',\r\n          text: `Could not export outlines. DETAILS: \"${err}\"`\r\n        })\r\n        throw err\r\n      })\r\n    },\r\n    exportPdfPlans () {\r\n      this.loading = true\r\n      const nestedPlans = this.allPlans.filter(plan =>\r\n        !plan.archived || this.includeArchived\r\n      ).map(plan => {\r\n        return plan.sections.filter(section =>\r\n          !section.archived || this.includeArchived\r\n        ).map(section => {\r\n          const title = plan.title === section.title\r\n            ? plan.title\r\n            : `${plan.title} - ${section.title}`\r\n\r\n          return {\r\n            title,\r\n            content: section.content\r\n          }\r\n        })\r\n      })\r\n\r\n      const planArray = [].concat(...nestedPlans)\r\n\r\n      chaptersToPdf(`${this.documentTitle}: Plans`, planArray).then(() => {\r\n        this.loading = false\r\n      }, err => {\r\n        this.loading = false\r\n        swal({\r\n          icon: 'error',\r\n          text: `Could not export plans. DETAILS: \"${err}\"`\r\n        })\r\n        throw err\r\n      })\r\n    },\r\n    getMasterTopic (chapterTopic) {\r\n      return this.masterTopics.find(topic => topic.guid === chapterTopic.guid)\r\n    },\r\n    setFile (event) {\r\n      swal({\r\n        buttons: true,\r\n        dangerMode: true,\r\n        icon: 'warning',\r\n        text: `Are you sure you want to import this file? It will overwrite everything in the current document.`,\r\n        title: 'Overwrite current document?'\r\n      }).then(willOverwrite => {\r\n        if (!willOverwrite) {\r\n          return\r\n        }\r\n\r\n        this.importBackup(event.target.files[0])\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.wrap {\r\n  display: flex;\r\n  justify-content: center;\r\n  width: 100%;\r\n}\r\n\r\n.exporter {\r\n  display: block;\r\n  flex: 1;\r\n  max-width: 1050px;\r\n}\r\n\r\n.export-option {\r\n  margin-bottom: 16px;\r\n}\r\n\r\n.export-checkbox {\r\n  margin-top: 8px;\r\n}\r\n\r\n.export-button {\r\n  margin: 10px 0;\r\n}\r\n\r\n.file-input-container {\r\n  cursor: pointer;\r\n  display: inline-block;\r\n  position: relative;\r\n}\r\n\r\n.file-input-label {\r\n  bottom: 0;\r\n  cursor: pointer;\r\n  left: 0;\r\n  opacity: 0;\r\n  padding: 0;\r\n  position: absolute;\r\n  right: 0;\r\n  top: 0;\r\n}\r\n\r\n.file-input {\r\n  border: none;\r\n  position: absolute;\r\n  visibility: hidden;\r\n}\r\n\r\n.file-dummy-button {\r\n  pointer-events: none;\r\n}\r\n</style>\r\n","import FileSaver from 'file-saver'\r\n\r\nexport const backupToJsonFile = (title, backup) => {\r\n  return new Promise((resolve) => {\r\n    const json = JSON.stringify(backup)\r\n    const blob = new Blob([json], { type: 'application/json' })\r\n    const today = new Date()\r\n    const date = `${today.getDate()}.${today.getMonth() + 1}.${today.getFullYear()}`\r\n    FileSaver.saveAs(blob, `${title}--${date}.json`)\r\n    resolve()\r\n  })\r\n}\r\n\r\nexport const jsonFileToBackup = file => {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader()\r\n\r\n    reader.onload = () => {\r\n      try {\r\n        const json = reader.result\r\n        resolve(JSON.parse(json))\r\n      } catch (e) {\r\n        reject(e)\r\n      }\r\n    }\r\n    reader.readAsText(file)\r\n  })\r\n}\r\n","function injectStyle (context) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"minimize\\\":true,\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"optionsId\\\":\\\"0\\\",\\\"vue\\\":true,\\\"id\\\":\\\"data-v-26e78664\\\",\\\"scoped\\\":true,\\\"sourceMap\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./exporter.page.vue\")\n}\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./exporter.page.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./exporter.page.vue\"\n/* template */\nimport {render as __vue_render__, staticRenderFns as __vue_static_render_fns__} from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-26e78664\\\",\\\"hasScoped\\\":true,\\\"optionsId\\\":\\\"0\\\",\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./exporter.page.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-26e78664\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nimport normalizeComponent from \"!../../../node_modules/vue-loader/lib/runtime/component-normalizer\"\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_render__,\n  __vue_static_render_fns__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"wrap\"},[_c('div',{staticClass:\"exporter\"},[_c('div',{staticClass:\"export-option\"},[_c('h3',[_vm._v(\"Export to PDF\")]),_vm._v(\" \"),_c('div',[_vm._v(\"(You can open PDFs in Microsoft Word.)\")]),_vm._v(\" \"),(_vm.loading)?_c('pulse-loader'):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"export-checkbox\"},[(!_vm.loading)?_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.includeArchived),expression:\"includeArchived\"}],attrs:{\"id\":\"includeArchived\",\"type\":\"checkbox\"},domProps:{\"checked\":Array.isArray(_vm.includeArchived)?_vm._i(_vm.includeArchived,null)>-1:(_vm.includeArchived)},on:{\"change\":function($event){var $$a=_vm.includeArchived,$$el=$event.target,$$c=$$el.checked?(true):(false);if(Array.isArray($$a)){var $$v=null,$$i=_vm._i($$a,$$v);if($$el.checked){$$i<0&&(_vm.includeArchived=$$a.concat([$$v]))}else{$$i>-1&&(_vm.includeArchived=$$a.slice(0,$$i).concat($$a.slice($$i+1)))}}else{_vm.includeArchived=$$c}}}}):_vm._e(),_vm._v(\" \"),(!_vm.loading)?_c('label',{attrs:{\"for\":\"includeArchived\"}},[_vm._v(\"Include Archived\")]):_vm._e()]),_vm._v(\" \"),(!_vm.loading)?_c('button',{staticClass:\"button-green export-button\",on:{\"click\":function($event){_vm.exportPdfChapters()}}},[_vm._v(\"\\n        Export all chapters\\n      \")]):_vm._e(),_vm._v(\" \"),(!_vm.loading)?_c('button',{staticClass:\"button-green export-button\",on:{\"click\":function($event){_vm.exportPdfPlans()}}},[_vm._v(\"\\n        Export all plans\\n      \")]):_vm._e(),_vm._v(\" \"),(!_vm.loading)?_c('button',{staticClass:\"button-green export-button\",on:{\"click\":function($event){_vm.exportPdfOutlines()}}},[_vm._v(\"\\n        Export all outlines\\n      \")]):_vm._e()],1),_vm._v(\" \"),_c('div',{staticClass:\"export-option\"},[_c('h3',[_vm._v(\"Create a backup\")]),_vm._v(\" \"),_c('div',[_vm._v(\"(You can recover your document from this file later.)\")]),_vm._v(\" \"),(_vm.loading)?_c('pulse-loader'):_vm._e(),_vm._v(\" \"),(!_vm.loading)?_c('button',{staticClass:\"button-green export-button\",on:{\"click\":function($event){_vm.exportJsonDocument()}}},[_vm._v(\"\\n        Export entire document\\n      \")]):_vm._e()],1),_vm._v(\" \"),_c('div',{staticClass:\"export-option\"},[_c('h3',[_vm._v(\"Import a backup\")]),_vm._v(\" \"),_c('div',[_vm._v(\"\\n        (Warning: This will overwrite the current document completely, including all chapters, plans and outlines.)\\n      \")]),_vm._v(\" \"),_c('div',{staticClass:\"file-input-container\"},[(_vm.loading)?_c('pulse-loader'):_vm._e(),_vm._v(\" \"),(!_vm.loading)?[_c('label',{staticClass:\"file-input-label\",attrs:{\"for\":\"import-file-picker\"}}),_vm._v(\" \"),_c('input',{staticClass:\"file-input\",attrs:{\"id\":\"import-file-picker\",\"type\":\"file\",\"accept\":\".json\"},on:{\"change\":_vm.setFile}}),_vm._v(\" \"),_c('button',{staticClass:\"button-green export-button file-dummy-button\"},[_vm._v(\"\\n            Import entire document\\n          \")])]:_vm._e()],2)])])])}\nvar staticRenderFns = []\nexport { render, staticRenderFns }"],"sourceRoot":""}